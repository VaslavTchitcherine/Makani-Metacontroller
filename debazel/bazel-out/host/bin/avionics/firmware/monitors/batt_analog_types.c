#include "avionics/firmware/monitors/batt_analog_types.h"

#include <stdbool.h>
#include <stddef.h>
#include <stdint.h>

#include "avionics/firmware/monitors/analog_types.h"
#include "avionics/firmware/serial/batt_serial_params.h"

static const AnalogMonitor kDeviceSmallCell17Ab[7] = {
  [0] = {
    .input = kBattAnalogInput12v,
    .voltage = kBattAnalogVoltage12v,
    .type = kAnalogTypeVoltage,
    .channel = 18,
    .volts_per_count = 0.00388941271552f,
    .offset = 0.0f,
    .nominal = 12.0f,
    .min = 11.4f,
    .max = 12.6f},
  [1] = {
    .input = kBattAnalogInput5v,
    .voltage = kBattAnalogVoltage5v,
    .type = kAnalogTypeVoltage,
    .channel = 19,
    .volts_per_count = 0.00388941271552f,
    .offset = 0.0f,
    .nominal = 5.0f,
    .min = 4.75f,
    .max = 5.25f},
  [2] = {
    .input = kBattAnalogInputIChg,
    .voltage = kBattAnalogVoltageIChg,
    .type = kAnalogTypeVoltage,
    .channel = 17,
    .volts_per_count = 0.00554865056818f,
    .offset = 2.70454545455f,
    .nominal = 0.0f,
    .min = 0.0f,
    .max = 15.0f},
  [3] = {
    .input = kBattAnalogInputIHall,
    .voltage = kBattAnalogVoltageIHall,
    .type = kAnalogTypeVoltage,
    .channel = 21,
    .volts_per_count = 0.0277432528409f,
    .offset = 15.0f,
    .nominal = 0.0f,
    .min = -1.5f,
    .max = 50.0f},
  [4] = {
    .input = kBattAnalogInputLvA,
    .voltage = kBattAnalogVoltageLvA,
    .type = kAnalogTypeVoltage,
    .channel = 14,
    .volts_per_count = 0.0364013671875f,
    .offset = 0.0f,
    .nominal = 70.0f,
    .min = 66.0f,
    .max = 80.0f},
  [5] = {
    .input = kBattAnalogInputLvB,
    .voltage = kBattAnalogVoltageLvB,
    .type = kAnalogTypeVoltage,
    .channel = 15,
    .volts_per_count = 0.0364013671875f,
    .offset = 0.0f,
    .nominal = 70.0f,
    .min = 62.3f,
    .max = 80.0f},
  [6] = {
    .input = kBattAnalogInputVLvOr,
    .voltage = kBattAnalogVoltageVLvOr,
    .type = kAnalogTypeVoltage,
    .channel = 16,
    .volts_per_count = 0.0364013671875f,
    .offset = 0.0f,
    .nominal = 70.0f,
    .min = 65.0f,
    .max = 80.0f},
};

static const AnalogMonitor kDeviceSmallCell15Ac[7] = {
  [0] = {
    .input = kBattAnalogInput12v,
    .voltage = kBattAnalogVoltage12v,
    .type = kAnalogTypeVoltage,
    .channel = 18,
    .volts_per_count = 0.00388941271552f,
    .offset = 0.0f,
    .nominal = 12.0f,
    .min = 11.4f,
    .max = 12.6f},
  [1] = {
    .input = kBattAnalogInput5v,
    .voltage = kBattAnalogVoltage5v,
    .type = kAnalogTypeVoltage,
    .channel = 19,
    .volts_per_count = 0.00388941271552f,
    .offset = 0.0f,
    .nominal = 5.0f,
    .min = 4.75f,
    .max = 5.25f},
  [2] = {
    .input = kBattAnalogInputIChg,
    .voltage = kBattAnalogVoltageIChg,
    .type = kAnalogTypeVoltage,
    .channel = 17,
    .volts_per_count = 0.00554865056818f,
    .offset = 2.70454545455f,
    .nominal = 0.0f,
    .min = 0.0f,
    .max = 15.0f},
  [3] = {
    .input = kBattAnalogInputIHall,
    .voltage = kBattAnalogVoltageIHall,
    .type = kAnalogTypeVoltage,
    .channel = 21,
    .volts_per_count = 0.0277432528409f,
    .offset = 15.0f,
    .nominal = 0.0f,
    .min = -1.5f,
    .max = 50.0f},
  [4] = {
    .input = kBattAnalogInputLvA,
    .voltage = kBattAnalogVoltageLvA,
    .type = kAnalogTypeVoltage,
    .channel = 14,
    .volts_per_count = 0.0364013671875f,
    .offset = 0.0f,
    .nominal = 70.0f,
    .min = 66.0f,
    .max = 80.0f},
  [5] = {
    .input = kBattAnalogInputLvB,
    .voltage = kBattAnalogVoltageLvB,
    .type = kAnalogTypeVoltage,
    .channel = 15,
    .volts_per_count = 0.0364013671875f,
    .offset = 0.0f,
    .nominal = 70.0f,
    .min = 55.0f,
    .max = 80.0f},
  [6] = {
    .input = kBattAnalogInputVLvOr,
    .voltage = kBattAnalogVoltageVLvOr,
    .type = kAnalogTypeVoltage,
    .channel = 16,
    .volts_per_count = 0.0364013671875f,
    .offset = 0.0f,
    .nominal = 70.0f,
    .min = 65.0f,
    .max = 80.0f},
};

static const AnalogMonitor kDeviceBigCell18Ac[7] = {
  [0] = {
    .input = kBattAnalogInput12v,
    .voltage = kBattAnalogVoltage12v,
    .type = kAnalogTypeVoltage,
    .channel = 18,
    .volts_per_count = 0.00388941271552f,
    .offset = 0.0f,
    .nominal = 12.0f,
    .min = 11.4f,
    .max = 12.6f},
  [1] = {
    .input = kBattAnalogInput5v,
    .voltage = kBattAnalogVoltage5v,
    .type = kAnalogTypeVoltage,
    .channel = 19,
    .volts_per_count = 0.00388941271552f,
    .offset = 0.0f,
    .nominal = 5.0f,
    .min = 4.75f,
    .max = 5.25f},
  [2] = {
    .input = kBattAnalogInputIChg,
    .voltage = kBattAnalogVoltageIChg,
    .type = kAnalogTypeVoltage,
    .channel = 17,
    .volts_per_count = 0.00554865056818f,
    .offset = 2.70454545455f,
    .nominal = 0.0f,
    .min = 0.0f,
    .max = 15.0f},
  [3] = {
    .input = kBattAnalogInputIHall,
    .voltage = kBattAnalogVoltageIHall,
    .type = kAnalogTypeVoltage,
    .channel = 21,
    .volts_per_count = 0.0277432528409f,
    .offset = 15.0f,
    .nominal = 0.0f,
    .min = -1.5f,
    .max = 50.0f},
  [4] = {
    .input = kBattAnalogInputLvA,
    .voltage = kBattAnalogVoltageLvA,
    .type = kAnalogTypeVoltage,
    .channel = 14,
    .volts_per_count = 0.0364013671875f,
    .offset = 0.0f,
    .nominal = 70.0f,
    .min = 55.0f,
    .max = 80.0f},
  [5] = {
    .input = kBattAnalogInputLvB,
    .voltage = kBattAnalogVoltageLvB,
    .type = kAnalogTypeVoltage,
    .channel = 15,
    .volts_per_count = 0.0364013671875f,
    .offset = 0.0f,
    .nominal = 70.0f,
    .min = 66.0f,
    .max = 80.0f},
  [6] = {
    .input = kBattAnalogInputVLvOr,
    .voltage = kBattAnalogVoltageVLvOr,
    .type = kAnalogTypeVoltage,
    .channel = 16,
    .volts_per_count = 0.0364013671875f,
    .offset = 0.0f,
    .nominal = 70.0f,
    .min = 65.0f,
    .max = 80.0f},
};

static const AnalogMonitor kDeviceSmallCell17Ad[7] = {
  [0] = {
    .input = kBattAnalogInput12v,
    .voltage = kBattAnalogVoltage12v,
    .type = kAnalogTypeVoltage,
    .channel = 18,
    .volts_per_count = 0.00388941271552f,
    .offset = 0.0f,
    .nominal = 12.0f,
    .min = 11.4f,
    .max = 12.6f},
  [1] = {
    .input = kBattAnalogInput5v,
    .voltage = kBattAnalogVoltage5v,
    .type = kAnalogTypeVoltage,
    .channel = 19,
    .volts_per_count = 0.00388941271552f,
    .offset = 0.0f,
    .nominal = 5.0f,
    .min = 4.75f,
    .max = 5.25f},
  [2] = {
    .input = kBattAnalogInputIChg,
    .voltage = kBattAnalogVoltageIChg,
    .type = kAnalogTypeVoltage,
    .channel = 17,
    .volts_per_count = 0.00512183129371f,
    .offset = 2.4965034965f,
    .nominal = 0.0f,
    .min = 0.0f,
    .max = 15.0f},
  [3] = {
    .input = kBattAnalogInputIHall,
    .voltage = kBattAnalogVoltageIHall,
    .type = kAnalogTypeVoltage,
    .channel = 21,
    .volts_per_count = 0.0277432528409f,
    .offset = 15.0f,
    .nominal = 0.0f,
    .min = -1.5f,
    .max = 50.0f},
  [4] = {
    .input = kBattAnalogInputLvA,
    .voltage = kBattAnalogVoltageLvA,
    .type = kAnalogTypeVoltage,
    .channel = 14,
    .volts_per_count = 0.0364013671875f,
    .offset = 0.0f,
    .nominal = 70.0f,
    .min = 66.0f,
    .max = 80.0f},
  [5] = {
    .input = kBattAnalogInputLvB,
    .voltage = kBattAnalogVoltageLvB,
    .type = kAnalogTypeVoltage,
    .channel = 15,
    .volts_per_count = 0.0364013671875f,
    .offset = 0.0f,
    .nominal = 70.0f,
    .min = 62.3f,
    .max = 80.0f},
  [6] = {
    .input = kBattAnalogInputVLvOr,
    .voltage = kBattAnalogVoltageVLvOr,
    .type = kAnalogTypeVoltage,
    .channel = 16,
    .volts_per_count = 0.0364013671875f,
    .offset = 0.0f,
    .nominal = 70.0f,
    .min = 65.0f,
    .max = 80.0f},
};

static const AnalogMonitor kDeviceSmallCell15V1[7] = {
  [0] = {
    .input = kBattAnalogInput12v,
    .voltage = kBattAnalogVoltage12v,
    .type = kAnalogTypeVoltage,
    .channel = 18,
    .volts_per_count = 0.00388941271552f,
    .offset = 0.0f,
    .nominal = 12.0f,
    .min = 11.4f,
    .max = 12.6f},
  [1] = {
    .input = kBattAnalogInput5v,
    .voltage = kBattAnalogVoltage5v,
    .type = kAnalogTypeVoltage,
    .channel = 19,
    .volts_per_count = 0.00388941271552f,
    .offset = 0.0f,
    .nominal = 5.0f,
    .min = 4.75f,
    .max = 5.25f},
  [2] = {
    .input = kBattAnalogInputIHall,
    .voltage = kBattAnalogVoltageIHall,
    .type = kAnalogTypeVoltage,
    .channel = 21,
    .volts_per_count = 0.0277432528409f,
    .offset = 15.0f,
    .nominal = 0.0f,
    .min = -1.5f,
    .max = 50.0f},
  [3] = {
    .input = kBattAnalogInputILvOr,
    .voltage = kBattAnalogVoltageILvOr,
    .type = kAnalogTypeVoltage,
    .channel = 17,
    .volts_per_count = 0.00554865056818f,
    .offset = 2.70454545455f,
    .nominal = 0.0f,
    .min = 0.0f,
    .max = 4.0f},
  [4] = {
    .input = kBattAnalogInputLvA,
    .voltage = kBattAnalogVoltageLvA,
    .type = kAnalogTypeVoltage,
    .channel = 14,
    .volts_per_count = 0.0364013671875f,
    .offset = 0.0f,
    .nominal = 70.0f,
    .min = 66.0f,
    .max = 80.0f},
  [5] = {
    .input = kBattAnalogInputLvB,
    .voltage = kBattAnalogVoltageLvB,
    .type = kAnalogTypeVoltage,
    .channel = 15,
    .volts_per_count = 0.0364013671875f,
    .offset = 0.0f,
    .nominal = 70.0f,
    .min = 55.0f,
    .max = 80.0f},
  [6] = {
    .input = kBattAnalogInputVLvOr,
    .voltage = kBattAnalogVoltageVLvOr,
    .type = kAnalogTypeVoltage,
    .channel = 16,
    .volts_per_count = 0.0364013671875f,
    .offset = 0.0f,
    .nominal = 70.0f,
    .min = 65.0f,
    .max = 80.0f},
};

static const AnalogMonitor kDeviceBigCell18V1[7] = {
  [0] = {
    .input = kBattAnalogInput12v,
    .voltage = kBattAnalogVoltage12v,
    .type = kAnalogTypeVoltage,
    .channel = 18,
    .volts_per_count = 0.00388941271552f,
    .offset = 0.0f,
    .nominal = 12.0f,
    .min = 11.4f,
    .max = 12.6f},
  [1] = {
    .input = kBattAnalogInput5v,
    .voltage = kBattAnalogVoltage5v,
    .type = kAnalogTypeVoltage,
    .channel = 19,
    .volts_per_count = 0.00388941271552f,
    .offset = 0.0f,
    .nominal = 5.0f,
    .min = 4.75f,
    .max = 5.25f},
  [2] = {
    .input = kBattAnalogInputIHall,
    .voltage = kBattAnalogVoltageIHall,
    .type = kAnalogTypeVoltage,
    .channel = 21,
    .volts_per_count = 0.0277432528409f,
    .offset = 15.0f,
    .nominal = 0.0f,
    .min = -1.5f,
    .max = 50.0f},
  [3] = {
    .input = kBattAnalogInputILvOr,
    .voltage = kBattAnalogVoltageILvOr,
    .type = kAnalogTypeVoltage,
    .channel = 17,
    .volts_per_count = 0.00554865056818f,
    .offset = 2.70454545455f,
    .nominal = 0.0f,
    .min = 0.0f,
    .max = 4.0f},
  [4] = {
    .input = kBattAnalogInputLvA,
    .voltage = kBattAnalogVoltageLvA,
    .type = kAnalogTypeVoltage,
    .channel = 14,
    .volts_per_count = 0.0364013671875f,
    .offset = 0.0f,
    .nominal = 70.0f,
    .min = 55.0f,
    .max = 80.0f},
  [5] = {
    .input = kBattAnalogInputLvB,
    .voltage = kBattAnalogVoltageLvB,
    .type = kAnalogTypeVoltage,
    .channel = 15,
    .volts_per_count = 0.0364013671875f,
    .offset = 0.0f,
    .nominal = 70.0f,
    .min = 66.0f,
    .max = 80.0f},
  [6] = {
    .input = kBattAnalogInputVLvOr,
    .voltage = kBattAnalogVoltageVLvOr,
    .type = kAnalogTypeVoltage,
    .channel = 16,
    .volts_per_count = 0.0364013671875f,
    .offset = 0.0f,
    .nominal = 70.0f,
    .min = 65.0f,
    .max = 80.0f},
};

static const AnalogMonitors kRevisionMap[11] = {
  [kBattHardwareSmallCell15V1] = {
    .channel_mask = 0x002FC000,
    .populated = 0x0000007F,
    .device = kDeviceSmallCell15V1,
    .num_devices = 7},
  [kBattHardwareBigCell18V1] = {
    .channel_mask = 0x002FC000,
    .populated = 0x0000007F,
    .device = kDeviceBigCell18V1,
    .num_devices = 7},
  [kBattHardwareSmallCell15Aa] = {
    .channel_mask = 0x002FC000,
    .populated = 0x0000007F,
    .device = kDeviceSmallCell15V1,
    .num_devices = 7},
  [kBattHardwareBigCell18Aa] = {
    .channel_mask = 0x002FC000,
    .populated = 0x0000007F,
    .device = kDeviceBigCell18V1,
    .num_devices = 7},
  [kBattHardwareSmallCell15Ab] = {
    .channel_mask = 0x002FC000,
    .populated = 0x0000007F,
    .device = kDeviceSmallCell15Ac,
    .num_devices = 7},
  [kBattHardwareBigCell18Ab] = {
    .channel_mask = 0x002FC000,
    .populated = 0x0000007F,
    .device = kDeviceBigCell18Ac,
    .num_devices = 7},
  [kBattHardwareSmallCell17Ab] = {
    .channel_mask = 0x002FC000,
    .populated = 0x0000007F,
    .device = kDeviceSmallCell17Ab,
    .num_devices = 7},
  [kBattHardwareSmallCell15Ac] = {
    .channel_mask = 0x002FC000,
    .populated = 0x0000007F,
    .device = kDeviceSmallCell15Ac,
    .num_devices = 7},
  [kBattHardwareBigCell18Ac] = {
    .channel_mask = 0x002FC000,
    .populated = 0x0000007F,
    .device = kDeviceBigCell18Ac,
    .num_devices = 7},
  [kBattHardwareSmallCell17Ac] = {
    .channel_mask = 0x002FC000,
    .populated = 0x0000007F,
    .device = kDeviceSmallCell17Ab,
    .num_devices = 7},
  [kBattHardwareSmallCell17Ad] = {
    .channel_mask = 0x002FC000,
    .populated = 0x0000007F,
    .device = kDeviceSmallCell17Ad,
    .num_devices = 7},
};

const AnalogMonitors *BattAnalogGetConfig(BattHardware batt_hardware) {
  // Avoid "always true" compiler warnings.
  int32_t i_batt_hardware = (int32_t)batt_hardware;
  if (0 <= i_batt_hardware && i_batt_hardware <= 10) {
    return &kRevisionMap[i_batt_hardware];
  }
  return NULL;
}
