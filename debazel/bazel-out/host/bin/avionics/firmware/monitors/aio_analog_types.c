#include "avionics/firmware/monitors/aio_analog_types.h"

#include <stdbool.h>
#include <stddef.h>
#include <stdint.h>

#include "avionics/firmware/monitors/analog_types.h"
#include "avionics/firmware/serial/aio_serial_params.h"

static const AnalogMonitor kDeviceRevAa[7] = {
  [0] = {
    .input = kAioAnalogInput2v5,
    .voltage = kAioAnalogVoltage2v5,
    .type = kAnalogTypeVoltage,
    .channel = 13,
    .volts_per_count = 0.000732421875f,
    .offset = 0.0f,
    .nominal = 2.5f,
    .min = 2.375f,
    .max = 2.625f},
  [1] = {
    .input = kAioAnalogInputGtiDetect,
    .voltage = kAioAnalogVoltageForceSigned,
    .type = kAnalogTypeLogicLow,
    .channel = 12,
    .volts_per_count = 0.0f,
    .offset = 0.0f,
    .nominal = 0.0f,
    .min = 0.0f,
    .max = 0.0f},
  [2] = {
    .input = kAioAnalogInputPortDetect0,
    .voltage = kAioAnalogVoltageForceSigned,
    .type = kAnalogTypePortDetect,
    .channel = 8,
    .volts_per_count = 0.0f,
    .offset = 0.0f,
    .nominal = 0.0f,
    .min = 0.0f,
    .max = 0.0f},
  [3] = {
    .input = kAioAnalogInputPortDetect1,
    .voltage = kAioAnalogVoltageForceSigned,
    .type = kAnalogTypePortDetect,
    .channel = 9,
    .volts_per_count = 0.0f,
    .offset = 0.0f,
    .nominal = 0.0f,
    .min = 0.0f,
    .max = 0.0f},
  [4] = {
    .input = kAioAnalogInputPortDetect2,
    .voltage = kAioAnalogVoltageForceSigned,
    .type = kAnalogTypePortDetect,
    .channel = 10,
    .volts_per_count = 0.0f,
    .offset = 0.0f,
    .nominal = 0.0f,
    .min = 0.0f,
    .max = 0.0f},
  [5] = {
    .input = kAioAnalogInputPortDetect3,
    .voltage = kAioAnalogVoltageForceSigned,
    .type = kAnalogTypePortDetect,
    .channel = 11,
    .volts_per_count = 0.0f,
    .offset = 0.0f,
    .nominal = 0.0f,
    .min = 0.0f,
    .max = 0.0f},
  [6] = {
    .input = kAioAnalogInputWatchdogEnabled,
    .voltage = kAioAnalogVoltageForceSigned,
    .type = kAnalogTypeLogicLow,
    .channel = 3,
    .volts_per_count = 0.0f,
    .offset = 0.0f,
    .nominal = 0.0f,
    .min = 0.0f,
    .max = 0.0f},
};

static const AnalogMonitor kDeviceRevAc[6] = {
  [0] = {
    .input = kAioAnalogInput2v5,
    .voltage = kAioAnalogVoltage2v5,
    .type = kAnalogTypeVoltage,
    .channel = 13,
    .volts_per_count = 0.000732421875f,
    .offset = 0.0f,
    .nominal = 2.5f,
    .min = 2.375f,
    .max = 2.625f},
  [1] = {
    .input = kAioAnalogInputGtiDetect,
    .voltage = kAioAnalogVoltageForceSigned,
    .type = kAnalogTypeLogicLow,
    .channel = 12,
    .volts_per_count = 0.0f,
    .offset = 0.0f,
    .nominal = 0.0f,
    .min = 0.0f,
    .max = 0.0f},
  [2] = {
    .input = kAioAnalogInputPortDetect0,
    .voltage = kAioAnalogVoltageForceSigned,
    .type = kAnalogTypePortDetect,
    .channel = 8,
    .volts_per_count = 0.0f,
    .offset = 0.0f,
    .nominal = 0.0f,
    .min = 0.0f,
    .max = 0.0f},
  [3] = {
    .input = kAioAnalogInputPortDetect1,
    .voltage = kAioAnalogVoltageForceSigned,
    .type = kAnalogTypePortDetect,
    .channel = 9,
    .volts_per_count = 0.0f,
    .offset = 0.0f,
    .nominal = 0.0f,
    .min = 0.0f,
    .max = 0.0f},
  [4] = {
    .input = kAioAnalogInputPortDetect2,
    .voltage = kAioAnalogVoltageForceSigned,
    .type = kAnalogTypePortDetect,
    .channel = 10,
    .volts_per_count = 0.0f,
    .offset = 0.0f,
    .nominal = 0.0f,
    .min = 0.0f,
    .max = 0.0f},
  [5] = {
    .input = kAioAnalogInputPortDetect3,
    .voltage = kAioAnalogVoltageForceSigned,
    .type = kAnalogTypePortDetect,
    .channel = 11,
    .volts_per_count = 0.0f,
    .offset = 0.0f,
    .nominal = 0.0f,
    .min = 0.0f,
    .max = 0.0f},
};

static const AnalogMonitor kDeviceRevAd[7] = {
  [0] = {
    .input = kAioAnalogInput2v5,
    .voltage = kAioAnalogVoltage2v5,
    .type = kAnalogTypeVoltage,
    .channel = 13,
    .volts_per_count = 0.000732421875f,
    .offset = 0.0f,
    .nominal = 2.5f,
    .min = 2.375f,
    .max = 2.625f},
  [1] = {
    .input = kAioAnalogInput5v,
    .voltage = kAioAnalogVoltage5v,
    .type = kAnalogTypeVoltage,
    .channel = 3,
    .volts_per_count = 0.00146484375f,
    .offset = 0.0f,
    .nominal = 5.0f,
    .min = 4.75f,
    .max = 5.25f},
  [2] = {
    .input = kAioAnalogInputGtiDetect,
    .voltage = kAioAnalogVoltageForceSigned,
    .type = kAnalogTypeLogicLow,
    .channel = 12,
    .volts_per_count = 0.0f,
    .offset = 0.0f,
    .nominal = 0.0f,
    .min = 0.0f,
    .max = 0.0f},
  [3] = {
    .input = kAioAnalogInputPortDetect0,
    .voltage = kAioAnalogVoltageForceSigned,
    .type = kAnalogTypePortDetect,
    .channel = 8,
    .volts_per_count = 0.0f,
    .offset = 0.0f,
    .nominal = 0.0f,
    .min = 0.0f,
    .max = 0.0f},
  [4] = {
    .input = kAioAnalogInputPortDetect1,
    .voltage = kAioAnalogVoltageForceSigned,
    .type = kAnalogTypePortDetect,
    .channel = 9,
    .volts_per_count = 0.0f,
    .offset = 0.0f,
    .nominal = 0.0f,
    .min = 0.0f,
    .max = 0.0f},
  [5] = {
    .input = kAioAnalogInputPortDetect2,
    .voltage = kAioAnalogVoltageForceSigned,
    .type = kAnalogTypePortDetect,
    .channel = 10,
    .volts_per_count = 0.0f,
    .offset = 0.0f,
    .nominal = 0.0f,
    .min = 0.0f,
    .max = 0.0f},
  [6] = {
    .input = kAioAnalogInputPortDetect3,
    .voltage = kAioAnalogVoltageForceSigned,
    .type = kAnalogTypePortDetect,
    .channel = 11,
    .volts_per_count = 0.0f,
    .offset = 0.0f,
    .nominal = 0.0f,
    .min = 0.0f,
    .max = 0.0f},
};

static const AnalogMonitor kDeviceRevBa[7] = {
  [0] = {
    .input = kAioAnalogInput2v5,
    .voltage = kAioAnalogVoltage2v5,
    .type = kAnalogTypeVoltage,
    .channel = 13,
    .volts_per_count = 0.000732421875f,
    .offset = 0.0f,
    .nominal = 2.5f,
    .min = 2.375f,
    .max = 2.625f},
  [1] = {
    .input = kAioAnalogInput5v,
    .voltage = kAioAnalogVoltage5v,
    .type = kAnalogTypeVoltage,
    .channel = 3,
    .volts_per_count = 0.00146484375f,
    .offset = 0.0f,
    .nominal = 5.0f,
    .min = 4.75f,
    .max = 5.25f},
  [2] = {
    .input = kAioAnalogInputGtiDetect,
    .voltage = kAioAnalogVoltageForceSigned,
    .type = kAnalogTypeLogicLow,
    .channel = 12,
    .volts_per_count = 0.0f,
    .offset = 0.0f,
    .nominal = 0.0f,
    .min = 0.0f,
    .max = 0.0f},
  [3] = {
    .input = kAioAnalogInputPortRssi0,
    .voltage = kAioAnalogVoltagePortRssi0,
    .type = kAnalogTypeVoltage,
    .channel = 8,
    .volts_per_count = 0.000813802083333f,
    .offset = 0.0f,
    .nominal = 0.1f,
    .min = 0.0f,
    .max = 1.0f},
  [4] = {
    .input = kAioAnalogInputPortRssi1,
    .voltage = kAioAnalogVoltagePortRssi1,
    .type = kAnalogTypeVoltage,
    .channel = 9,
    .volts_per_count = 0.000813802083333f,
    .offset = 0.0f,
    .nominal = 0.1f,
    .min = 0.0f,
    .max = 1.0f},
  [5] = {
    .input = kAioAnalogInputPortRssi2,
    .voltage = kAioAnalogVoltagePortRssi2,
    .type = kAnalogTypeVoltage,
    .channel = 10,
    .volts_per_count = 0.000813802083333f,
    .offset = 0.0f,
    .nominal = 0.1f,
    .min = 0.0f,
    .max = 1.0f},
  [6] = {
    .input = kAioAnalogInputPortRssi3,
    .voltage = kAioAnalogVoltagePortRssi3,
    .type = kAnalogTypeVoltage,
    .channel = 11,
    .volts_per_count = 0.000813802083333f,
    .offset = 0.0f,
    .nominal = 0.1f,
    .min = 0.0f,
    .max = 1.0f},
};

static const AnalogMonitors kRevisionMap[5] = {
  [kAioHardwareRevAa] = {
    .channel_mask = 0x00003F08,
    .populated = 0x0000007F,
    .device = kDeviceRevAa,
    .num_devices = 7},
  [kAioHardwareRevAb] = {
    .channel_mask = 0x00003F08,
    .populated = 0x0000007F,
    .device = kDeviceRevAa,
    .num_devices = 7},
  [kAioHardwareRevAc] = {
    .channel_mask = 0x00003F00,
    .populated = 0x0000003F,
    .device = kDeviceRevAc,
    .num_devices = 6},
  [kAioHardwareRevAd] = {
    .channel_mask = 0x00003F08,
    .populated = 0x0000007F,
    .device = kDeviceRevAd,
    .num_devices = 7},
  [kAioHardwareRevBa] = {
    .channel_mask = 0x00003F08,
    .populated = 0x0000007F,
    .device = kDeviceRevBa,
    .num_devices = 7},
};

const AnalogMonitors *AioAnalogGetConfig(AioHardware aio_hardware) {
  // Avoid "always true" compiler warnings.
  int32_t i_aio_hardware = (int32_t)aio_hardware;
  if (0 <= i_aio_hardware && i_aio_hardware <= 4) {
    return &kRevisionMap[i_aio_hardware];
  }
  return NULL;
}
